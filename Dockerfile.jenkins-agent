FROM openjdk:17-jdk-alpine

# Create jenkins user
RUN addgroup -S jenkins && adduser -S -G jenkins -u 1000 jenkins

# Install common tools
RUN apk add --no-cache \
    bash \
    curl \
    jq \
    git \
    openssh \
    python3 \
    py3-pip \
    ca-certificates \
    docker-cli \
    && pip3 install --no-cache-dir awscli

# Install kubectl
RUN curl -L -o /tmp/kubectl https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl \
    && chmod +x /tmp/kubectl && mv /tmp/kubectl /usr/local/bin/kubectl

# Install helm
RUN curl -fsSL https://get.helm.sh/helm-v3.12.0-linux-amd64.tar.gz -o /tmp/helm.tar.gz \
    && tar -xzvf /tmp/helm.tar.gz -C /tmp \
    && mv /tmp/linux-amd64/helm /usr/local/bin/helm \
    && rm -rf /tmp/*

# Set user and workspace
USER 1000:1000
ENV HOME=/home/jenkins
WORKDIR /home/jenkins

CMD ["cat"]
